var E=(j)=>{let C=typeof j;if(j===void 0||j===null)return 0;else if(j instanceof Array||C==="string")return j.length;else if(j instanceof Map||j instanceof Set)return j.size;else if(Object.getPrototypeOf(j)===Object.prototype)return Object.keys(C).length;return 1},O=new DOMParser,P=Object.assign((j)=>j===void 0||j===null?P.Null:j instanceof Array?P.List:Object.getPrototypeOf(j)===Object.prototype?P.Dict:typeof j==="number"?P.Number:typeof j==="string"?P.String:typeof j==="boolean"?P.Boolean:P.Object,{Null:1,Number:2,Boolean:3,String:4,Object:5,List:10,Dict:11}),M=(j,C)=>{if(j===null||j===void 0||typeof j==="number"||typeof j==="string")return j;else if(j instanceof Array)return j.map(C);else if(j instanceof Map){let z=new Map;for(let[B,H]of j.entries())z.set(B,C(H,B));return z}else if(j instanceof Set){let z=new Set;for(let B of j)z.add(C(B,void 0));return z}else{let z={};for(let B in j)z[B]=C(j[B],B);return z}},b=(j,C)=>j===C,V=(j)=>j===null||j===void 0?"":typeof j==="number"?`${j}`:typeof j==="string"?j:JSON.stringify(j),q=(j)=>{switch(j.nodeName){case"INPUT":case"TEXTAREA":case"SELECT":return!0;default:return!1}},Y=(j,C)=>{switch(j.nodeType){case Node.TEXT_NODE:j.data=C;break;case Node.ELEMENT_NODE:if(q(j)){if(j.value!==C)j.value=C}else j.textContent=C;break}return j};class D{constructor(j,C,z){this.name=j,this.data=C,this.origin=z,this.current=void 0}}class R{constructor(j,C){this.template=j,this.data=C}}class Q{static Path(j,C,z){let B=[];while(j!==C)B.splice(0,0,Array.prototype.indexOf.call(j.parentNode.childNodes,j)),j=j.parentNode;return z?z.concat(B):B}static Find(j,C,z=void 0){let B={},H=0,G=`[${j}]`,J=(K,L,$)=>{let X=K.getAttribute(j);K.removeAttribute(j);let W=new Q(K,L,Q.Path(K,L,[$]));if(W=z?z(W,X):W,B[X]===void 0)B[X]=[W];else B[X].push(W);return H++,B};for(let K=0;K<C.length;K++){let L=C[K];if(L.matches&&L.matches(G))J(L,L,K);if(L.querySelectorAll)for(let $ of L.querySelectorAll(`[${j}]`))J($,L,K)}return H?B:null}constructor(j,C,z){this.node=j,this.parent=C,this.path=z,this.predicate=void 0,this.predicatePlaceholder=void 0}apply(j,C,z=!1){let B=j;for(let H of this.path)if(B instanceof Array)B=B[H];else B=B?B.childNodes[H]:B;return B?z?B:new w(B,this,C):null}}class F{constructor(j){this.nodes=j,this.on=Q.Find("on",j),this.in=Q.Find("in",j),this.out=Q.Find("out",j),this.inout=Q.Find("inout",j),this.ref=Q.Find("ref",j),this.when=Q.Find("when",j,(C,z)=>{return C.predicate=Function(`return ((self,data,event)=>(${z}))`)(),C.predicatePlaceholder=document.createComment(z),C}),this.initializer=void 0,this.behavior=void 0,this.subs=void 0}new(j){return new Z(this,j)}apply(j){return new R(this,j)}map(j){return M(j,(C)=>new R(this,j))}init(j){return this.initializer=j,this}does(j){return this.behavior=Object.assign(this.behavior??{},j),this}sub(j,C=void 0){if(typeof j==="string"){if(!C)return this;if(this.subs===void 0)this.subs=new Map;if(this.subs.has(j))this.subs.get(j).push(C);else this.subs.set(j,[C])}else for(let z in j)this.sub(z,j[z]);return this}}class w{constructor(j,C,z){this.parent=z,this.node=j,this.mapping=new Map,this.placeholder=j.childNodes?[...j.childNodes]:null,this.predicatePlaceholder=C.predicate&&C.predicatePlaceholder?C.predicatePlaceholder.cloneNode(!0):null,this.template=C}render(j){let C=P(j);if(E(j)===0){if(this.placeholder&&!this.placeholder[0]?.parentNode){let G=this.node.childNodes[0];for(let J of this.placeholder){if(!G||!G.nextSibling)this.node.appendChild(J);else this.node.insertBefore(J,G.nextSibling);G=J}}}else if(this.placeholder&&this.placeholder[0]?.parentNode)for(let G of this.placeholder)G.parentNode?.removeChild(G);let z=C===P.List||C===P.Dict?j:{_:j},B=null;for(let G in z){let J=z[G];if(!this.mapping.has(G)){let K=void 0;if(J instanceof R)K=J.template.new(this.parent),K.set(J.data,G).mount(this.node,B),B=K.nodes.at(-1);else if(q(this.node))Y(this.node,V(J)),K=this.node;else if(J instanceof Node)this.node.appendChild(J),K=J;else K=document.createTextNode(V(J)),this.node.appendChild(K),B=K;this.mapping.set(G,K)}else{let K=this.mapping.get(G);if(K instanceof Z)if(J instanceof R)if(J.template===K.template)K.set(J.data,G);else console.error("Not implemented: change in element");else K.set(J,G);else if(q(this.node))Y(this.node,V(J));else if(K?.nodeType===Node.ELEMENT_NODE)if(J instanceof R)console.error("Not implemented: change from non UIInstance to UIInstance");else if(J instanceof Node)K.parentNode.replaceChild(J,K),this.mapping.set(G,J);else{let L=document.createTextNode(V(J));K.parentNode.replaceChild(L,K),this.mapping.set(G,L)}else if(J instanceof R)console.error("Not implemented: change from non UIInstance to UIInstance");else if(J instanceof Node)K.parentNode.replaceChild(J,K),this.mapping.set(G,J);else Y(K,V(J))}}let H=[];for(let[G,J]of this.mapping.entries())if(z[G]===void 0){if(J instanceof Z)J.unmount();else if(J!==this.node)J.parentNode?.removeChild(J);H.push(G)}for(let G of H)this.mapping.delete(G)}show(){if(this.predicatePlaceholder&&this.predicatePlaceholder.parentNode)this.predicatePlaceholder.parentNode.replaceChild(this.node,this.predicatePlaceholder);return this}hide(){if(this.predicatePlaceholder&&this.node.parentNode)this.node.parentNode.replaceChild(this.predicatePlaceholder,this.node);return this}}class Z{constructor(j,C){if(this.template=j,this.nodes=j.nodes.map((z)=>z.cloneNode(!0)),this.in=M(j.in,(z)=>M(z,(B)=>B.apply(this.nodes,this))),this.out=M(j.out,(z)=>M(z,(B)=>B.apply(this.nodes,this))),this.inout=M(j.inout,(z)=>M(z,(B)=>B.apply(this.nodes,this))),this.ref=M(j.ref,(z)=>{let B=M(z,(H)=>H.apply(this.nodes,this,!0));return B.length===1?B[0]:B}),this.on=M(j.on,(z)=>M(z,(B)=>B.apply(this.nodes,this))),this.when=M(j.when,(z)=>M(z,(B)=>B.apply(this.nodes,this))),this.parent=C,this.data=void 0,this.key=void 0,this.dataType=P.Null,this.rendered=new Map,this.behavior=new Map,this.predicate=void 0,this.bind(),this.initial=void 0,this._renderer=()=>this.render(),j.initializer){let z=j.initializer();if(z){for(let B in z){let H=z[B];if(H&&H?.isReactive)H.sub(this._renderer)}this.initial=z}this.set(z)}}dispose(){if(this.initial)for(let j in this.initial){let C=this.initial[j];if(C&&C?.isReactive)C.unsub(this._renderer)}}bind(){for(let j of[this.on,this.in,this.inout])for(let C in j)for(let z of j[C])this._bind(C,z)}_bind(j,C,z=this.template.behavior[j]){if(z instanceof Function)z={_:z};if(z)for(let B in z){let H=z[B];if(B==="_")switch(C.node.nodeName){case"INPUT":case"TEXTAREA":case"SELECT":B="input";break;case"FORM":B="submit";break;default:B="click"}C.node.addEventListener(B,(G)=>H(this,this.data||{},G))}}set(j,C=this.key){return this.key=C,this.render(j),this}update(j,C=!1){let z=C?!1:!0;if(!this.data)z=!1;else if(z)for(let B in j){let H=this.data[B],G=j[B];if(!b(H,G)){if(z=!1,H?.isReactive)H.unsub(this._renderer);if(G?.isReactive)G.sub(this._renderer)}}if(!z)this.render(this.data?Object.assign(this.data,j):j);return this}send(j,C){return this.pub(j,C)}pub(j,C){let z=new D(j,C,this);return this.parent?.onPub(z),z}onPub(j){j.current=this;let C=!0;if(this.template.subs){let z=this.template.subs.get(j.name);if(z)for(let B of z){let H=B(this,this.data,j);if(H===!1)return j;else if(H===null)C=!1}}return C&&this.parent?.onPub(j),j}mount(j,C){if(typeof j==="string"){let z=document.querySelector(j);if(!z)return console.error("Selector is empty, cannot mounted component",j,{component:this.template}),this;else j=z}if(j)if(this.nodes[0].parentNode!==j)for(let z of this.nodes)j.appendChild(z);else console.warn("Already mounted",this.nodes);else{console.warn("Unable to mount as node is empty");for(let z of this.nodes)z.parentNode?.removeChild(z)}return this}unmount(){for(let j of this.nodes)j.parentNode?.removeChild(j);return this}render(j=this.data){let C=P(j);if(!(this.template.out||this.template.inout||this.templates.inout)){let z=V(j);for(let B of this.nodes)if(B.nodeType===Node.ELEMENT_NODE){Y(B,z);break}}else{for(let z of[this.out,this.inout,this.in])if(z)for(let B in z){let H=j;if(this.template.behavior[B])if(this.behavior.has(B))H=this.behavior.get(B);else{let G=this.template.behavior[B];H=G(this,j,null),this.behavior.set(B,H)}for(let G of z[B])G.render(H)}this.behavior.clear();for(let z in this.when)for(let B of this.when[z])if(B.template.predicate(self,j))B.show();else B.hide()}return this.data=j,this.dataType=C,this}}var N=(j,C=document)=>{if(typeof j==="string"){let z=[];if(/\s*</.test(j))z=[...O.parseFromString(j,"text/html").body.childNodes];else for(let G of document.querySelectorAll(j))if(G.nodeName==="TEMPLATE")z=[...z,...G.content.childNodes];else z.push(G);let B=new F(z),H=(...G)=>B.apply(...G);return Object.assign(H,{isTemplate:!0,template:B,new:(...G)=>B.new(...G),init:(...G)=>B.init(...G),map:(...G)=>B.map(...G),apply:(...G)=>B.apply(...G),does:(...G)=>(B.does(...G),H),on:(...G)=>(B.sub(...G),H),sub:(...G)=>(B.sub(...G),H)}),H}},A=N;export{N as ui,P as type,M as remap,E as len,A as default};
