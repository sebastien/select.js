const p=Element.prototype.matches?1:Element.prototype.mozMatchesSelector?2:Element.prototype.webkitMatchesSelector?3:null,c=p?(h,t)=>{let n;if(h.startsWith(":first")&&(h=h.substring(0,h.length-6),n=0),n==null)try{switch(p){case 1:return t&&t.matches&&t.matches(h);case 2:return t&&t.mozMatchesSelector&&t.mozMatchesSelector(h);case 3:return t&&t.webkitMatchesSelector&&t.webkitMatchesSelector(h);default:return console.error("select.match: browser not supported"),select.STATUS="FAILED",t.matches(h)}}catch(e){return console.error("select.match: exception occurred with selector",h,"and node",t,":",e),null}else return query(h,void 0,n)[n]==t}:(h,t)=>{if(h.endsWith(":first"))return query(h,t)==t;{const n=t.parentNode;if(n){const e=n.querySelectorAll(h);for(let s=0;s<e.length;s++)if(e[s]===t)return!0}return!1}};export const query=(h,t,n)=>{if(h=h.trim(),!h||h.length==0)return[t];if(h[0]==">"){h=h.substr(1).trim();const e=Math.min(Math.max(h.indexOf(">"),0),Math.max(h.indexOf(" "),0)),s=e>0?h.substring(0,e):h,i=e>0?h.substring(e,h.length):null,r=[],o=(t||document).childNodes;let f=null;for(let d=0;e<o.length;d++){const l=o[d];c(s,l)&&l.nodeType==Node.ELEMENT_NODE&&r.push(l)}if(i){f=[];for(let d=0;d<r.length;d++)f=f.concat(select.query(i,r[e]))}else f=r;return f}else{let e;h.endsWith(":first")&&(h=h.substring(0,h.length-6),e=0);let s=[];const i=(t||document).querySelectorAll(h);let r=0;for(let o=0;o<i.length;o++){const f=i[o];if(f.nodeType==Node.ELEMENT_NODE)if(e===void 0)s.push(f),r+=1;else if(e==r){s.push(f);break}else r+=1}return s}},filter=(h,t)=>{const n=[];for(let e=0;e<t.length;e++){const s=t[e];c(h,s)&&n.push(s)}return n};export class Selection extends Array{constructor(t,n){super();let e=null;return typeof t=="string"?n?(n=select(n),e=n.find(t)):e=query(t):Selection.Is(t)?(e=t,n=t.scope,t=t.selector,t.scope&&n!=t.scope&&console.error("Selection.new: given scope differs from first argument's",n,"!=",t.scope)):t&&(e=Selection.AsElementList(t)),this.selector=t,this.scope=n,this.isSelection=!0,this.expand(e),this}static Is(t){return t&&t.__class__===Selection}static IsList(t){return t instanceof Selection||t instanceof Array||t instanceof NodeList}static IsElement(t){return t&&typeof t.nodeType<"u"&&t.nodeType==Node.ELEMENT_NODE}static IsText(t){return t&&typeof t.nodeType<"u"&&t.nodeType==Node.TEXT_NODE}static IsNode(t){return t&&typeof t.nodeType<"u"}static IsDOM(t){return t&&typeof t.getBBox>"u"}static IsSVG(t){return typeof t.getBBox<"u"}static IsSelection(t){return t instanceof Selection}static AsElementList(t){if(t){if(t.nodeType==Node.ELEMENT_NODE)return[t];if(t.nodeType==Node.DOCUMENT_FRAGMENT_NODE||t.nodeType==Node.DOCUMENT_NODE){const n=[];let e=t.firstElementChild;for(;e;)n.push(e),e=e.nextSibling;return n}else{if(t===window)return Selection.AsElementList(window.document);if(Selection.IsList(t)){let n=[];for(let e=0;e<t.length;e++)n=n.concat(Selection.AsElementList(t[e]));return n}else return[]}}else return t}static Ensure(t){return Selection.Is(t)?t:new Selection(t)}find(t){if(this.length==0)return new Selection;const n=[];for(let e=0;e<this.length;e++){const s=this[e],i=query(t,s);for(let r=0;r<i.length;r++)n.push(i[r])}return new Selection(n,this)}filter(t){return typeof t=="string"?new Selection(filter(t,this),this.length>0?this:void 0):typeof t=="function"?new Selection(Array.prototype.filter.apply(this,[t])):(console.error("Selection.filter(): selector string or predicate expected, got",t),None)}iterate(t){const n=this;for(let e=0;e<n.length&&t(new Selection(n[e]),e)!==!1;e++);return this}like(t){return this.is(t)}is(t){if(typeof t=="string"){let n=this.length>0;for(let e=0;e<this.length;e++)if(!c(t,this[e])){n=!1;break}return n}else return this.equals(t)}list(){return this.map(Selection.Ensure)}first(){return this.length<=1?this:select([this[0]],this)}last(){return this.length<=1?this:select([this[this.length-1]],this)}eq(t){return this.get(t)}get(t){return t=t<0?this.length+t:t,this.length==1&&t==0?this:0<=t<this.length?select([this[t]],this):new Selection}next(t){const n=[];for(let e=0;e<this.length;e++){const i=this[e].nextElementSibling;i&&(!t||c(t,i))&&n.push(i)}return n.length>0?select(n,this):new Selection}prev(t){return this.previous(t)}previous(t){const n=[];for(let e=0;e<this.length;e++){const i=this[e].previousElementSibling;i&&(!t||c(t,i))&&n.push(i)}return n.length>0?select(n,this):new Selection}parent(t){const n=[];for(let e=0;e<this.length;e++){const s=this[e].parentNode;s&&(!t||c(t,s))&&n.push(s)}return n.length>0?select(n,this):new Selection}ancestors(t,n){return this.parents(t,n)}parents(t,n){const e=[],s=typeof n=="number"?n:-1,i=n&&typeof n!="number"?select(n):null,r=typeof t=="function",o=typeof t=="string";o&&t.endsWith(":first")&&(t=t.substring(0,t.length-6),index=0);for(let f=0;f<this.length;f++){let d=this[f].parentNode;for(;d;){let l=!0;if(t&&(r?l=t(d,f):o&&(l=c(t,d))),l&&(e.push(d),s>=0&&e.length>=s))return select(e,this);d=d.parentNode,i&&i.contains(d)&&(d=null)}}return e.length>0?select(e,this):new Selection}children(t){const n=[];for(let e=0;e<this.length;e++){const s=this[e];for(let i=0;i<s.childNodes.length;i++){const r=s.childNodes[i];Selection.IsElement(r)&&(!t||c(t,r))&&n.push(r)}}return n.length>0?select(n,this):new Selection}nodes(t){const n=[];for(let e=0;e<this.length;e++){const s=this[e];for(let i=0;i<s.childNodes.length;i++){const r=s.childNodes[i];if(!t||t(r,e,s)!==!1)n.push(r);else return n}}return n}walk(t){if(!t)return this;const n=[];let e=0;for(let s=0;s<this.length;s++){const i=this[s];for(n.push(i);n.length>0;){const r=n.pop();if(t&&t(r,e++)===!1)return this;for(let o=0;o<r.childNodes.length;o++)n.push(r.childNodes[o])}}return this}append(t){if(this.length==0)return this;const n=this[0];if(Selection.Is(t))for(let e=0;e<t.length;e++)n.appendChild(t[e]);else if(t&&typeof t.nodeType<"u")n.appendChild(t);else if(Selection.IsList(t))for(let e=0;e<t.length;e++)this.append(t[e]);else if(typeof t=="string")for(let e=0;e<this.length;e++)this[e].appendChild(document.createTextNode(t));else if(typeof t=="number")for(let e=0;e<this.length;e++)this[e].appendChild(document.createTextNode(t));else t&&console.error("Selection.append: value is expected to be Number, String, Node, [Node] or Selection, got",t);return this}prepend(t){if(this.length==0)return this;const n=this[0],e=n.firstChild;if(!e)return this.append(t);if(Selection.Is(t))for(let s=0;s<t.length;s++)n.insertBefore(t[s],e);else if(t&&typeof t.nodeType<"u")n.insertBefore(t,e);else if(Selection.IsList(t))for(let s=0;s<t.length;s++)this.prepend(t[s]);else if(typeof t=="string")for(let s=0;s<this.length;s++)this[s].insertBefore(document.createTextNode(t),e);else if(typeof t=="number")for(let s=0;s<this.length;s++)this[s].insertBefore(document.createTextNode(t),e);else t&&console.error("Selection.prepend: value is expected to be Number, String, Node, [Node] or Selection, got",t);return this}remove(){for(let t=0;t<this.length;t++){const n=this[t];n.parentNode&&n.parentNode.removeChild(n)}return this}extend(t){if(Selection.IsNode(t))this.push(t);else if(Selection.IsList(t))for(let n=0;n<t.length;n++)this.extend(t[n]);else console.error("Selection.extend: value must be a node, selection or list, got",t);return this}after(t){if(this.length==0)return this;const n=this[0];let e=n;for(;e&&!Selection.IsElement(e.nextSibling);)e=e.nextSibling;if(e)if(Selection.Is(t))for(let s=0;s<t.length;s++)e.parentNode.insertBefore(t[s],e);else if(typeof t.length<"u")for(let s=0;s<t.length;s++)e.parentNode.insertBefore(t[s],e);else typeof t.nodeType<"u"?e.parentNode.insertBefore(t,e):console.error("Selection.after: value is expected to be Node, [Node] or Selection, got",t);else if(e=n.parentNode,Selection.Is(t))for(let s=0;s<t.length;s++)e.appendChild(t[s]);else if(typeof t.length<"u")for(let s=0;s<t.length;s++)e.appendChild(t[s]);else typeof t.nodeType<"u"?e.appendChild(t):console.error("Selection.after: value is expected to be Node, [Node] or Selection, got",t);return this}before(t){if(this.length==0)return this;const e=this[0],s=e.parentNode;if(Selection.Is(t))for(let i=0;i<t.length;i++)s.insertBefore(t[i],e);else if(typeof t.length<"u")for(let i=0;i<t.length;i++)s.insertBefore(t[i],e);else typeof t.nodeType<"u"?s.insertBefore(t,e):console.error("Selection.before: value is expected to be Node, [Node] or Selection, got",t);return this}replaceWith(t){if(this.length==0){if(console.warn("Selection.replaceWith: current selection is empty, so given nodes will be removed"),Selection.IsNode(t))t.parentNode&&t.parentNode.removeChild(t);else if(Selection.IsSelection(t)||Selection.IsList(t))for(let n=0;n<t.length;n++){const e=t[n];e.parentNode&&e.parentNode.removeChild(e)}return this}else{const n=this[0],e=n.parentNode,s=[];if(Selection.IsNode(t))e&&e.insertBefore(t,n),s.push(t);else if(Selection.IsSelection(t)||Selection.IsList(t)){const i=[];for(let r=0;r<t.length;r++){const o=t[r];e&&e.insertBefore(o,n),i.push(o)}}else console.error("Selection.replaceWith: value is expected to be Node, [Node] or Selection, got",t);for(;this.length>0;){const i=this.pop();i.parentNode&&i.parentNode.removeChild(i)}for(;s.length>0;)this.push(s.pop())}return this}equals(t){if(typeof t=="string")return this.equals(query(t));if(t instanceof Array){if(t.length!=this.length)return!1;for(let n=0;n<this.length;n++)if(t[n]!=this[n])return!1;return!0}else return Selection.IsElement(t)?this.length==1&&this[0]===t:!1}contains(t){if(t instanceof Array||Selection.IsElement(t)){let n=!0;for(let e=0;n&&e<this.length;e++)n=this.indexOf(t[e])>=0;return n}else return this.indexOf(t)>=0}wrap(t){return t=$(t),t.add(this),t}clone(){if(this.length===0)return new(Object.getPrototypeOf(this)).constructor;let t;for(const n of this)t===void 0?t=new(Object.getPrototypeOf(this)).constructor(n.cloneNode(!0)):t.push(n.cloneNode(!0));return t}empty(){for(let t=0;t<this.length;t++){const n=this[t];for(;n.firstChild;)n.removeChild(n.firstChild)}return this}isEmpty(){return this.length==0}val(){return this.value()}value(t){if(typeof t>"u"){for(let n=0;n<this.length;n++){const e=this[n];if(typeof e.value<"u")return e.value;if(e.hasAttribute("contenteditable"))return e.textContent}return}else{t=""+t;for(let n=0;n<this.length;n++){const e=this[n];typeof e.value<"u"?e.value=t:e.hasAttribute("contenteditable")&&(e.textContent=t)}return this}}text(t){let n;if(typeof t>"u"){for(let e=0;e<this.length;e++)if(n=this[e].textContent,n)return n;return n}else{t=t==null?"":typeof t=="number"?`${t}`:typeof t=="string"?t:JSON.stringify(t);for(let e=0;e<this.length;e++){const s=this[e];switch(s.nodeName){case"INPUT":case"TEXTAREA":case"SELECT":s.value!==t&&(s.value=t);break;default:s.textContent=t}}return this}}html(t){return this.contents(t)}contents(t){let n;if(typeof t>"u"){for(let e=0;e<this.length;e++)if(n=this[e].innerHTML,n)return n;return n}else if(!t||typeof t=="string"||typeof t=="number"){t=t||"";for(let e=0;e<this.length;e++){const s=this[e];s.innerHTML=t}return this}else return this.empty().append(t)}attr(t,n){if(typeof t=="string")if(arguments.length==1){for(let e=0;e<this.length;e++){const s=this[e];if(s.hasAttribute(t))return s.getAttribute(t)}return}else{n=typeof n=="string"||n===null?n:JSON.stringify(n);for(let e=0;e<this.length;e++){const s=this[e];n===null?s.hasAttribute(t)&&s.removeAttribute(t):s.setAttribute(t,n)}return this}else if(t){for(const e in t)this.attr(e,t[e]);return this}return this}data(t,n,e){if(t)if(typeof t=="string"){const s=`data-${t}`;let i;if(typeof n>"u"){for(let r=0;r<this.length;r++){const o=this[r];let f;o.hasAttribute(s)&&(f=o.getAttribute(s));let d=typeof o.dataset<"u"?o.dataset[t]:f;try{d=JSON.parse(d)}catch{}if(typeof d<"u")return d}return}else{i=typeof n=="string"?n:JSON.stringify(n);for(let r=0;r<this.length;r++){const o=this[r];typeof o.dataset<"u"?o.dataset[t]=i:o.setAttribute(s,i)}return this}}else{for(const s in t)this.data(s,t[s]);return this}else{for(let s=0;s<this.length;s++){const i=this[s];if(i.dataset){const r={};for(const o in i.dataset){v=i.dataset[o];try{v=JSON.parse(v)}catch{}r[o]=v}return r}else{const r=i.attributes;let o;for(let f=0;f<r.length;f++){const d=r[f],l=d.name;if(l.startsWith("data-")){let u=d.value;try{u=JSON.parse(u)}catch{}o=o||{},o[l.substring(5,l.length)]=u}}return o}}return}}addClass(t){if(t instanceof Array){for(let n=0;n<t.length;n++)this.addClass(t[n]);return this}if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.addClass(arguments[n]);return this}for(let n=0;n<this.length;n++){const e=this[n];if(e.classList)e.classList.add(t);else{const s=e.getAttribute("class");if(s&&s.length>0){const i=s.indexOf(t),r=s.length||0,o=t.length,f=d-1,d=i+o;(i==0||s[f]==" ")&&(d==r||s[d]==" ")||e.setAttribute(s+" "+t)}else e.setAttribute(t)}}return this}removeClass(t){for(let n=0;n<this.length;n++){const e=this[n];if(e.classList)e.classList.remove(t);else{let s=e.getAttribute("class");if(s&&s.length>0){const i=s.indexOf(t);if(i>=0){const r=s.length||0,o=t.length;let f="";for(;i>=0;){const d=l-1,l=i+o;(i==0||s[d]==" ")&&(l==r||s[l]==" ")?f+=s.substr(0,i):f+=s.substr(0,i+o),s=s.substr(i+o)}f+=s,e.setAttribute("class",f)}}}}return this}hasClass(t){const n=(t||"").length;for(let e=0;e<this.length;e++){const s=this[e];if(typeof s.classList<"u")return s.classList.contains(t);{const i=s.className||"";if(i&i.length>0){const r=i.indexOf(t);if(r>=0){const o=i.length||0,f=r-1,d=r+n+1;if((r==0||i[f]==" ")&&(r==o||i[d]==" "))return!0}}}}return!1}toggleClass(t,n){const e=select(),s=n instanceof Function;for(let i=0;i<this.length;i++){const r=this[i],o=s?n(r,i):n;e.set(this[i]),typeof n>"u"?e.hasClass(t)?e.removeClass(t):e.addClass(t):o&&!e.hasClass(t)?e.addClass(t):!o&&e.hasClass(t)&&e.removeClass(t)}return this}css(t,n){if(typeof t=="string")if(typeof n>"u"){for(let e=0;e<this.length;e++){const s=document.defaultView.getComputedStyle(this[e],null)[t];if(typeof s<"u")return s}return}else{n=typeof n=="string"?n:n+"px";for(let e=0;e<this.length;e++)this[e].style[t]=n;return this}else{for(const e in t)this.css(e,t[e]);return this}return this}width(){for(let t=0;t<this.length;t++){const e=this[t].getBoundingClientRect();return e.right-e.left}return 0}height(){for(let t=0;t<this.length;t++){const e=this[t].getBoundingClientRect();return e.bottom-e.top}return 0}offset(){for(let t=0;t<this.length;t++){const n=this[t];if(Selection.IsDOM(n))return{left:n.offsetLeft,top:n.offsetTop};{const e=n.getBoundingClientRect(),s=n.parentNode.getBoundingClientRect();return{left:e.left-s.left,top:e.top-s.top}}}}scrollTop(t){const n=t!==void 0;for(let e=0;e<this.length;e++){const s=this[e];if(Selection.IsDOM(s))if(n)s.scrollTop=t;else return s.scrollTop;else console.error("Selection.scrollTop: Not implemented for SVG")}}scrollLeft(t){const n=t!==void 0;for(let e=0;e<this.length;e++){const s=this[e];if(Selection.IsDOM(s))if(n)s.scrollLeft=t;else return s.scrollLeft;else console.error("Selection.scrollLeft: Not implemented for SVG")}}focus(t){if(typeof t>"u"){for(let n=0;n<this.length;n++){const e=this[n];if(e.focus&&(e.focus(),document.activeElement==e))return this}return this}else return this.bind("select",t)}select(t){if(typeof t>"u"){const n=window.getSelection();n.removeAllRanges();for(let e=0;e<this.length;e++){const s=this[e];if(s.select)s.select();else{const i=new Range;s.nodeType==s.TEXT_NODE?i.selectNode(s):i.selectNodeContents(s),n.removeAllRanges(),n.addRange(i)}}return this}else return this.bind("select",t)}bind(t,n,e){e=e&&!0;for(let s=0;s<this.length;s++)this[s].addEventListener(t,n,e);return this}unbind(t,n){for(let e=0;e<this.length;e++)this[e].removeEventListener(t,n);return this}trigger(t){if(typeof t=="string"){const n=t;t=document.createEvent("HTMLEvents"),t.initEvent(n,!0,!0)}for(let n=0;n<this.length;n++)this[n].dispatchEvent(t);return this}node(t){if(t=t||0,t=t<0?this.length-t:t,t>=0&&t<this.length)return this[t]}set(t){return this.clear().expand(t)}copy(t){return new Selection().expand(t)}clear(t){return t=t||0,super.splice(t,this.length-t),this}expand(t){if((t==window||t==document)&&(t=document.firstElementChild),!t||t.length==0)return this;if(typeof t=="string")return this.expand(query(t));if(Selection.IsElement(t))this.push(t);else if(t.nodeType==Node.DOCUMENT_NODE)this.expand(t.firstElementChild);else if(t instanceof NodeList||Selection.IsList(t))for(let n=0;n<t.length;n++)this.expand(t[n]);else console.error("Selection.expand: Unsupported argument",t);return this}}export const select=(h,t)=>Selection.Is(h)&&!t?h:new Selection(h,t);Object.assign(select,{Selection,VERSION:"1.0.0b0",NAME:"select",STATUS:"LOADED",isNode:Selection.IsNode,isText:Selection.IsText,filter,match:c,query,select});export const S=select,$=select;export default select;
